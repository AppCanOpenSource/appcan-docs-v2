[TOC]
# 1ï½¤ç®€ä»‹ [![](http://appcan-download.oss-cn-beijing.aliyuncs.com/%E5%85%AC%E6%B5%8B%2Fgf.png)]()
å†…éƒ¨æ”¯ä»˜(IAP)æ’ä»¶
## 1.1ï½¤è¯´æ˜
å°è£…å†…éƒ¨æ”¯ä»˜(IAP)ç›¸å…³æ“ä½œ
## 1.2ï½¤UIå±•ç¤º

## 1.3ï½¤å…¬å‘Š [![](http://appcan-download.oss-cn-beijing.aliyuncs.com/%E5%85%AC%E6%B5%8B%2Fnew.gif)]() 

iOSå¼€å‘çš„æ”¶å…¥æœ‰ä¸‰ç§æ¥æº:å‡ºå”®åº”ç”¨ï½¤å†…è´­å’Œå¹¿å‘Š.å›½å†…ç”¨æˆ·é€šå¸¸å¾ˆå°‘ç›´æ¥è´­ä¹°åº”ç”¨,å› æ­¤å¯¹äºå¼€å‘è€…è€Œè¨€(ç‰¹åˆ«æ˜¯ä¸ªäººå¼€å‘è€…),å†…è´­å’Œå¹¿å‘Šæ”¶å…¥å°±æˆäº†ä¸»è¦çš„æ”¶å…¥æ¥æº.å†…è´­è¥é”€æ¨¡å¼,é€šå¸¸è½¯ä»¶æœ¬èº«æ˜¯ä¸æ”¶è´¹çš„,ä½†æ˜¯è¦è·å¾—æŸäº›ç‰¹æƒå°±å¿…é¡»è´­ä¹°ä¸€äº›é“å…·,éœ€è¦é€šè¿‡å†…è´­çš„æ–¹å¼æ¥å®ç°,è€Œå†…è´­çš„è¿‡ç¨‹æ˜¯ç”±è‹¹æœå®˜æ–¹ç»Ÿä¸€æ¥ç®¡ç†çš„.
    
## 1.4ï½¤å¼€æºæºç 
æ’ä»¶æµ‹è¯•ç”¨ä¾‹ä¸æºç ä¸‹è½½:[ç‚¹å‡»](http://plugin.appcan.cn/details.html?id=567) æ’ä»¶ä¸­å¿ƒè‡³æ’ä»¶è¯¦æƒ…é¡µ (æ’ä»¶æµ‹è¯•ç”¨ä¾‹ä¸æ’ä»¶æºç å·²ç»æä¾›)
## 1.5ï½¤å¹³å°ç‰ˆæœ¬æ”¯æŒ
æœ¬æ’ä»¶çš„æ‰€æœ‰APIé»˜è®¤åªæ”¯æŒ***iOS7.0+**æ“ä½œç³»ç»Ÿ,**ä¸æ”¯æŒAndroid**.
æœ‰ç‰¹æ®Šç‰ˆæœ¬è¦æ±‚çš„APIä¼šåœ¨æ–‡æ¡£ä¸­é¢å¤–è¯´æ˜.

## 1.6ï½¤æ¥å£æœ‰æ•ˆæ€§
æœ¬æ’ä»¶æ‰€æœ‰APIé»˜è®¤åœ¨æ’ä»¶ç‰ˆæœ¬**4.0.0+**å¯ç”¨.  
åœ¨åç»­ç‰ˆæœ¬ä¸­æ–°æ·»åŠ çš„æ¥å£ä¼šåœ¨æ–‡æ¡£ä¸­é¢å¤–è¯´æ˜.
# 2ï½¤APIæ¦‚è§ˆ

##2.1ï½¤æ–¹æ³•

### ğŸ­ getProductList è·å–æœ‰æ•ˆçš„äº§å“åˆ—è¡¨

`uexInAppPurchase.getProductList(params,callback);`     

                
                

**è¯´æ˜:**

è¯¥æ–¹æ³•ä»è‹¹æœæœåŠ¡å™¨è¿”å›æœ‰æ•ˆäº§å“ä¿¡æ¯,åŒ…æ‹¬äº§å“æè¿°ä¿¡æ¯ï½¤å‚è€ƒåç§°ï½¤ä»·æ ¼ï½¤äº§å“ID,é€šè¿‡cbGetProductListå›è°ƒå®ç°.

               

**å‚æ•°:**

| å‚æ•°åç§°     | å‚æ•°ç±»å‹     | æ˜¯å¦å¿…é€‰ | è¯´æ˜           |
| -------- | -------- | ---- | ------------ |
| param     | Object   | æ˜¯    | æ¥å£æ‰€éœ€æ•°æ®,å½¢å¼è§ä¸‹: |
| callback | Function | æ˜¯    | å›è°ƒæ–¹æ³•         |

 ```
var params = {
    productIDs:[] 
}
 ```
| å‚æ•°åç§° | å‚æ•°ç±»å‹ | æ˜¯å¦å¿…é€‰ | è¯´æ˜ |
| ----- | ----- | ----- | ----- |
|  productIDs   | Array | æ˜¯ | åœ¨è‹¹æœå®˜ç½‘å†…è´­é¡¹ç›®ä¸­å¡«å†™çš„äº§å“ID |

**å›è°ƒå‚æ•°:**

```javascript
var callback = function (error,data){}
```

| å‚æ•°åç§°  | ç±»å‹     | è¯´æ˜           |
| ----- | ------ | ------------ |
| error | Number | 0è¡¨ç¤ºæˆåŠŸ,é0è¡¨ç¤ºå¤±è´¥ |
| data  | String | ä»è‹¹æœæœåŠ¡å™¨è·å–çš„æœ‰æ•ˆäº§å“ä¿¡æ¯,æ ¼å¼å¦‚ä¸‹:|

```
var data = [
   {
     "productIdentifier":,
     "localizedTitle":,
     "price":,
     "localizedDescription"
   }
   ...
]
```


 å„å­—æ®µå«ä¹‰å¦‚ä¸‹:

|å‚æ•°|æ˜¯å¦å¿…é¡»|è¯´æ˜|
|-----|-----|-----|
|productIdentifier|æ˜¯|äº§å“ID|
|localizedTitle|æ˜¯|å‚è€ƒåç§°|
|price|æ˜¯|ä»·æ ¼ç­‰çº§|
|localizedDescription|æ˜¯|äº§å“æè¿°ä¿¡æ¯|

**ç¤ºä¾‹:**

```
var params = {
     "productIDs": ["EnergyBottle","GoldenGlobe","ProtectiveGloves"]
};            
uexInAppPurchase.getProductList(params,function(error,data){
    if(!error){
       alert(JSON.stringify(data));
    }
});
```
### ğŸ­ canMakePay æµ‹è¯•è®¾å¤‡æ˜¯å¦æ”¯æŒæ”¯ä»˜åŠŸèƒ½

`var result = uexInAppPurchase.canMakePay();`
 


**è¯´æ˜:**

è¯¥æ–¹æ³•æµ‹è¯•è®¾å¤‡æ˜¯å¦æ”¯æŒæ”¯ä»˜åŠŸèƒ½,æ”¯æŒåŒæ­¥è¿”å›.

               

**å‚æ•°**

æ— 

**è¿”å›å€¼**

|  å‚æ•°åç§° | å‚æ•°ç±»å‹  | æ˜¯å¦å¿…é€‰  |  è¯´æ˜ |
| ----- | ----- | ----- | ----- |
| result| Number | æ˜¯ | 0è¡¨ç¤ºè®¾å¤‡å…è®¸å†…è´­,1è®¾å¤‡ç¦æ­¢å†…è´­| 


**ç¤ºä¾‹:**

```
 var result = uexInAppPurchase.canMakePay();
 
 alert(result);
```
### ğŸ­ purchase è´­ä¹°å•ä¸€äº§å“

uexInAppPurchase.purchase(params);
     
  

**è¯´æ˜:**

è¯¥äº§å“åº”è¯¥ä¸ºä»æœåŠ¡å™¨è¿”å›çš„æŸä¸€äº§å“,ä»cbGetProductListä¸­è·å–,è¯¥äº§å“å¯ä»¥æ˜¯æ¶ˆè€—å“æˆ–éæ¶ˆè€—å“ä»¥åŠå…¶å®ƒç±»å‹,å¼€å‘äººå‘˜åº”å¯¹éæ¶ˆè€—å“è¿›è¡Œé€»è¾‘å¤„ç†,éæ¶ˆè€—å“æ— éœ€å†æ¬¡è´­ä¹°.

                

**å‚æ•°:**

 ```
var params = {
       productID: ,
       quantity: ,
       appStoreVerifyURL: 
}
 ```
|  å‚æ•°åç§° | å‚æ•°ç±»å‹  | æ˜¯å¦å¿…é€‰  |  è¯´æ˜ |
| ----- | ----- | ----- | ----- |
| productID | String | æ˜¯ |æŸä¸€äº§å“ID,é€šè¿‡cbGetProductListè·å–| 
| quantity | Number | å¦ |è´­ä¹°çš„æ•°é‡,é»˜è®¤ä¸º1 | 
| appStoreVerifyURL | bool | æ˜¯ |trueä¸ºå®é™…è´­ä¹°éªŒè¯;falseä¸ºæ²™ç›’æµ‹è¯• | 

**ç¤ºä¾‹:**

```
var params = {
        "productID": "EnergyBottle",
        "quantity":"2",
        "appStoreVerifyURL": true
  };
uexInAppPurchase.purchase(params);
```

### ğŸ­restorePurchase æ¢å¤è´­ä¹°æ–¹æ³•

`uexInAppPurchase.restorePurchase();`	

**è¯´æ˜:**

æ¢å¤æ‰€æœ‰éæ¶ˆè€—å“,å¯¹äºéæ¶ˆè€—å“,ç”¨æˆ·åœ¨å®Œæˆè´­ä¹°åå¦‚æœä½¿ç”¨å…¶ä»–æœºå™¨ç™»å½•æˆ–è€…å¸è½½é‡æ–°å®‰è£…åº”ç”¨åé€šå¸¸å¸Œæœ›è¿™äº›éæ¶ˆè€—å“èƒ½å¤Ÿæ¢å¤.
		

**å‚æ•°:**

æ— 
 

**ç¤ºä¾‹:**

```
uexInAppPurchase.restorePurchase();               
```

## 2.1ï½¤ç›‘å¬æ–¹æ³•

### ğŸ­ onRequestState å¯¹å‘é€äº§å“è¯·æ±‚è¿›è¡Œç›‘å¬

`onRequestState(result)`

**è¯´æ˜:**

 å½“å‘è‹¹æœæœåŠ¡å™¨å‘é€è¯·æ±‚è·å–æœ‰æ•ˆäº§å“ä¿¡æ¯æ—¶,å¯¹getProductListæ–¹æ³•ä¸­å‘é€è¯·æ±‚çš„çŠ¶æ€è¿›è¡Œç›‘å¬

**å‚æ•°:**

| å‚æ•°åç§° | å‚æ•°ç±»å‹   | æ˜¯å¦å¿…é€‰ | è¯´æ˜           |
| ---- | ------ | ---- | ------------ |
| result | String | æ˜¯    | å½¢å¼è§ä¸‹: |

```
var result ={
    status:,
    errorCode:,
    errorDescription
}
```

|  å‚æ•°åç§° | å‚æ•°ç±»å‹  | æ˜¯å¦å¿…é€‰  |  è¯´æ˜ |
| ----- | ----- | ----- | ----- |
| status | Number | æ˜¯ |å‘é€äº§å“è¯·æ±‚çš„çŠ¶æ€,0è¡¨ç¤ºè¯·æ±‚å®Œæˆ,1è¡¨ç¤ºè¯·æ±‚å¤±è´¥ | 
| errorCode | Number | å¦ |statusä¸º1æ‰æœ‰,é”™è¯¯çŠ¶æ€ç  | 
| errorDescription | String | å¦ |statusä¸º1æ‰æœ‰,é”™è¯¯çŠ¶æ€çš„æè¿°ä¿¡æ¯ | 


**ç¤ºä¾‹:**

```
function onRequestState(result) {
    alert(result);
}
window.uexOnload = function(){
    uexInAppPurchase.onRequestState = onRequestState;
}
```
### ğŸ­ onPurchaseState å¯¹äº§å“è´­ä¹°çŠ¶æ€çš„ç›‘å¬æ–¹æ³•

`onPurchaseState(result)`

**è¯´æ˜:**

 å½“è¿›è¡Œè´­ä¹°åŠ¨ä½œæ—¶,è¦å¯¹è´­ä¹°çš„äº§å“çš„æœ‰æ•ˆæ€§è¿›è¡Œåˆ¤æ–­,å³å¯¹purchaseæ–¹æ³•ä¸­äº§å“ä¿¡æ¯çš„æœ‰æ•ˆæ€§è¿›è¡Œç›‘å¬
 
**å‚æ•°:**

| å‚æ•°åç§° | å‚æ•°ç±»å‹   | æ˜¯å¦å¿…é€‰ | è¯´æ˜           |
| ---- | ------ | ---- | ------------ |
| result | String | æ˜¯    | å½¢å¼è§ä¸‹: |

```
var result ={
    status:,
    msg:
}
```

|  å‚æ•°åç§° | å‚æ•°ç±»å‹  | æ˜¯å¦å¿…é€‰  |  è¯´æ˜ |
| ----- | ----- | ----- | ----- |
| status | Number | æ˜¯ |è´­ä¹°äº§å“çš„æœ‰æ•ˆæ€§,0è¡¨ç¤ºäº§å“æœ‰æ•ˆ,1è¡¨ç¤ºäº§å“æ— æ•ˆ | 
| msg | String | æ˜¯ |äº§å“æœ‰æ•ˆè¿”å›"purchase start",äº§å“æ— æ•ˆè¿”å›"product is nil" | 
 

**ç¤ºä¾‹:**

```
function onPurchaseState(result) {
    alert(result);
}
window.uexOnload = function(){
    uexInAppPurchase.onPurchaseState = onPurchaseState;
}
```


### ğŸ­ onTransactionState å¯¹äº§å“äº¤æ˜“çŠ¶æ€å’Œä¿¡æ¯çš„ç›‘å¬æ–¹æ³•

`onTransactionState(result)`

**è¯´æ˜:**

 å½“è´­ä¹°çš„äº§å“ä¸ºæœ‰æ•ˆäº§å“æ—¶,ä¼šå°†æœ‰æ•ˆäº§å“åŠ å…¥æ”¯ä»˜é˜Ÿåˆ—å°±å½¢æˆä¸€æ¬¡è´­ä¹°è¯·æ±‚,å¹¶ä¸”ç”¨æˆ·å…è®¸å†…è´­æ—¶,å°†ä¼šè¿›è¡Œäº¤æ˜“.è¯¥æ–¹æ³•æ˜¯å¯¹ç”¨æˆ·äº¤æ˜“çŠ¶æ€çš„ç›‘å¬.


**å‚æ•°:**

| å‚æ•°åç§° | å‚æ•°ç±»å‹   | æ˜¯å¦å¿…é€‰ | è¯´æ˜           |
| ---- | ------ | ---- | ------------ |
| result | String | æ˜¯    | å½¢å¼è§ä¸‹: |

```
var result ={

    //statusä¸º0
    receipt: ,//äº¤æ˜“æˆåŠŸçš„è¯¦ç»†ä¿¡æ¯
    
    //statusä¸º1
    transactionDate: ,//String,äº¤æ˜“æ—¥æœŸ
    transactionIdentifier ,//String,äº¤æ˜“æ ‡è¯†ç¬¦
    originalTransaction ,//json,åŸå§‹äº¤æ˜“ä¿¡æ¯
    productIdentifier ,//String,è´­ä¹°çš„äº§å“ID
    quantity ,//Number,è´­ä¹°äº§å“æ•°é‡
    
    //statusä¸º2æˆ–3
    errorCode , //Number,é”™è¯¯æ ‡è¯†ç 
    errorDescription ,//String,é”™è¯¯çš„æè¿°ä¿¡æ¯
    productIdentifier,//String, è´­ä¹°çš„äº§å“ID
    
    //statusä¸º4
    msg: ,//è¿”å›"responseData is nil"
}
```
|  å‚æ•°åç§° | å‚æ•°ç±»å‹  | æ˜¯å¦å¿…é€‰  |  è¯´æ˜ |
| ----- | ----- | ----- | ----- |
| status | Number | æ˜¯ |äº¤æ˜“çŠ¶æ€æ ‡è¯†ç¬¦,è¯¦ç»†è¯´æ˜è§ä¸‹| 

 statuså­—æ®µå«ä¹‰å¦‚ä¸‹:

|  value | è¯´æ˜  |
| ----- | ----- |
| 0 | é€šè¿‡éªŒè¯,è´­ä¹°æˆåŠŸ |
| 1 | æ¢å¤æˆåŠŸ |
| 2 | è´­ä¹°å¤±è´¥ |
| 3 | éªŒè¯è´­ä¹°è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ |
| 4 | éªŒè¯è´­ä¹°è¿‡ç¨‹ä¸­è¿”å›æ•°æ®ä¸ºç©º |


**ç¤ºä¾‹:**

```
function onTransactionState(result) {
    alert(result);
}
window.uexOnload = function(){
    uexInAppPurchase.onTransactionState = onTransactionState;
}
```


### ğŸ­ onRestoreState å¯¹äº§å“æ¢å¤è´­ä¹°çš„çŠ¶æ€è¿›è¡Œç›‘å¬

`onRestoreState(result)`

**è¯´æ˜:**

 å¯¹äºéæ¶ˆè€—å“,ç”¨æˆ·åœ¨å®Œæˆè´­ä¹°åå¦‚æœä½¿ç”¨å…¶ä»–æœºå™¨ç™»å½•æˆ–è€…å¸è½½é‡æ–°å®‰è£…åº”ç”¨åé€šå¸¸å¸Œæœ›è¿™äº›éæ¶ˆè€—å“èƒ½å¤Ÿæ¢å¤,è¯¥ç›‘å¬æ–¹æ³•æ˜¯å¯¹restorePurchaseæ–¹æ³•è¿›è¡Œç›‘å¬,è¿”å›æ¢å¤è´­ä¹°çš„çŠ¶æ€.

**å‚æ•°:**

| å‚æ•°åç§° | å‚æ•°ç±»å‹   | æ˜¯å¦å¿…é€‰ | è¯´æ˜           |
| ---- | ------ | ---- | ------------ |
| result | String | æ˜¯    | å½¢å¼è§ä¸‹: |

```
var result ={
    status:,
    errorCode:,
    errorDescription
}
```

|  å‚æ•°åç§° | å‚æ•°ç±»å‹  | æ˜¯å¦å¿…é€‰  |  è¯´æ˜ |
| ----- | ----- | ----- | ----- |
| status | Number | æ˜¯ |æ¢å¤è´­ä¹°çš„çŠ¶æ€,0è¡¨ç¤ºæ¢å¤è´­ä¹°å®Œæˆ,1è¡¨ç¤ºæ¢å¤è´­ä¹°å¤±è´¥ | 
| errorCode | Number | å¦ |statusä¸º1æ‰æœ‰,é”™è¯¯çŠ¶æ€ç  | 
| errorDescription | String | å¦ |statusä¸º1æ‰æœ‰,é”™è¯¯çŠ¶æ€çš„æè¿°ä¿¡æ¯ |  



**ç¤ºä¾‹:**

```
function onRestoreState(result) {
    alert(result);
}
window.uexOnload = function(){
    uexInAppPurchase.onRestoreState = onRestoreState;
}
```
# 3ï½¤æ›´æ–°å†å²

### iOS

APIç‰ˆæœ¬: `uexInAppPurchase-4.0.0`

æœ€è¿‘æ›´æ–°æ—¶é—´:`2016-9-9`

| å†å²å‘å¸ƒç‰ˆæœ¬ | æ›´æ–°å†…å®¹ |
| ----- | ----- |
| 4.0.0 | å†…è´­æ’ä»¶4.0 |

### Android

**æš‚ä¸æ”¯æŒ!**
